<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Haraka Manual &raquo; Transaction Object</title>
        <link rel="stylesheet" type="text/css" href="/reset.css">
        <link rel="stylesheet" type="text/css" href="/chapter.css">
        <link rel="stylesheet" type="text/css" href="/sh_emacs.css">
        <script type="text/javascript" src="/sh_main.min.js"></script>
        <script type="text/javascript" src="/sh_javascript.min.js"></script>
        <script type="text/javascript">
        window.onload = function () {
            var pres = document.getElementsByTagName("pre"),
                text;

            for (var i = 0; i < pres.length; ++i) {
                text = pres[i].innerText || "";

                if (!(/^\s*\$/).test(text)) {
                    pres[i].className = "sh_javascript";
                }
            }

            sh_highlightDocument();
        }
        </script>
    </head>
    <body>
        <div id="content">
            <h1>Transaction Object</h1>

<p>An SMTP transaction is valid from MAIL FROM time until RSET or "final-dot".</p>

<h2>API</h2>

<ul>
<li>transaction.uuid</li>
</ul>

<p>A unique UUID for this transaction. Is equal to the connection.uuid + '.N'
where N increments for each transaction on this connection.</p>

<ul>
<li>transaction.mail_from</li>
</ul>

<p>The value of the MAIL FROM command as an <code>Address</code> object.</p>

<ul>
<li>transaction.rcpt_to</li>
</ul>

<p>An Array of <code>Address</code> objects of recipients from the RCPT TO command.</p>

<ul>
<li>transaction.data_lines</li>
</ul>

<p>An Array of the lines of the email after DATA.</p>

<ul>
<li>transaction.data_bytes</li>
</ul>

<p>The number of bytes in the email after DATA.</p>

<ul>
<li>transaction.add_data(line)</li>
</ul>

<p>Adds a line of data to the email. Note this is RAW email - it isn't useful
for adding banners to the email.</p>

<ul>
<li>transaction.notes</li>
</ul>

<p>A safe place to store transaction specific values.</p>

<ul>
<li>transaction.add<em>leading</em>header(key, value)</li>
</ul>

<p>Adds a header to the top of the header list.  This should only be used in
very specific cases.  Most people will want to use add_header() instead.</p>

<ul>
<li>transaction.add_header(key, value)</li>
</ul>

<p>Adds a header to the email.</p>

<ul>
<li>transaction.remove_header(key)</li>
</ul>

<p>Deletes a header from the email.</p>

<ul>
<li>transaction.header</li>
</ul>

<p>The header of the email. See <code>Header Object</code>.</p>

<ul>
<li>transaction.parse_body</li>
</ul>

<p>Set to 1 to enable parsing of the mail body. Make sure you set this in
hook_data or before.</p>

<ul>
<li>transaction.body</li>
</ul>

<p>The body of the email if you set <code>parse_body</code> above. See <code>Body Object</code>.</p>

<ul>
<li>transaction.attachment_hooks(start, data, end)</li>
</ul>

<p>Sets event emitter hooks for attachments if you set <code>parse_body</code> above.</p>

<p>The <code>start</code> event will receive <code>(content_type, filename, body)</code> as parameters.</p>

<p>The <code>data</code> event will receive a <code>Buffer</code> object containing some of the
attachment data.</p>

<p>The <code>end</code> event will be called with no parameters when an attachment ends.</p>

<p>Both the <code>data</code> and <code>end</code> params are optional.</p>

<p>Note that in the <code>start</code> event, you can set per-attachment events via:</p>

<pre><code>body.on('attachment_data', cb)
body.on('attachment_end', cb)
</code></pre>

<ul>
<li>transaction.set_banner(text, html)</li>
</ul>

<p>Sets a banner to be added to the end of the email. If the html part is not
given (optional) then the text part will have each line ending replaced with
<code>&lt;br/&gt;</code> when being inserted into HTML parts.</p>

        </div>
    </body>
</html>
